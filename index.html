<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purdue Parking Map</title>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin: 10px;
        }
        #map {
            height: 600px;
            width: 100%;
        }
        #controls {
            padding: 10px;
            background: #f4f4f4;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 1px solid #ccc;
        }
        #controls label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #controls input, #controls select {
            padding: 4px;
        }
    </style>
</head>
<body>

    <h1>Purdue Parking Finder</h1>

    <div id="controls">
        <label>Pass Type: 
            <select id="passType">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="Visitor">Visitor</option>
                <option value="None">None</option>
            </select>
        </label>

        <label>Destination Building:
            <input type="text" id="building" placeholder="e.g., LILY">
        </label>

        <label>Free Parking Only:
            <input type="checkbox" id="freeOnly">
        </label>

        <label>Visit Time:
            <input type="time" id="visitTime">
        </label>

        <button onclick="filterParking()">Find Parking</button>
    </div>

    <div id="map"></div>

    <script>
        // Initialize the map at Purdue coordinates
        var map = L.map('map').setView([40.4237, -86.9212], 15);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Sample markers (buildings or parking lots)
        var sampleLots = [
            { name: "Grant Street Garage", coords: [40.4249, -86.9119], type: "Visitor" },
            { name: "University Street Garage", coords: [40.4258, -86.9180], type: "A/B" },
            { name: "South Campus Lot", coords: [40.4175, -86.9215], type: "Free" }
        ];

        var markers = [];

        sampleLots.forEach(lot => {
            let marker = L.marker(lot.coords).addTo(map)
                .bindPopup(`<b>${lot.name}</b><br>Type: ${lot.type}`);
            markers.push({ lot: lot, marker: marker });
        });

        // Filter function (simplified for now)
        function filterParking() {
            const passType = document.getElementById('passType').value;
            const freeOnly = document.getElementById('freeOnly').checked;

            markers.forEach(obj => {
                const lot = obj.lot;
                const marker = obj.marker;
                let visible = true;

                if (freeOnly && lot.type !== "Free") visible = false;
                if (!freeOnly && passType !== "None" && lot.type.indexOf(passType) === -1 && lot.type !== "Visitor") {
                    visible = false;
                }

                if (visible) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });
        }

        fetch('data/parking_lots.geojson')
          .then(res => res.json())
          .then(data => {
            L.geoJSON(data, {
                style: feature => {
                    const occ = feature.properties.occupancy;
                    let color = occ > 0.8 ? 'red' : occ > 0.5 ? 'orange' : 'green';
                    return { color: color, weight: 2, fillOpacity: 0.4 };
                },
                onEachFeature: (feature, layer) => {
                    const name = feature.properties.name;
                    const occupancy = (feature.properties.occupancy * 100).toFixed(0);
                    const address = feature.properties.address;
        
                    // Use coordinates to open Google Maps
                    const center = layer.getBounds().getCenter(); 
                    const lat = center.lat;
                    const lng = center.lng;
        
                    const googleMapsURL = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
        
                    layer.bindPopup(`
                        <b>${name}</b><br>
                        Occupancy: ${occupancy}%<br>
                        <a href="${googleMapsURL}" target="_blank">Get Directions</a>
                    `);
                }
            }).addTo(map);
          });
    </script>

</body>
</html>
